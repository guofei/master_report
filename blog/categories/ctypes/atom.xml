<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: ctypes | Master Report]]></title>
  <link href="http://guofei.github.com/master_report/blog/categories/ctypes/atom.xml" rel="self"/>
  <link href="http://guofei.github.com/master_report/"/>
  <updated>2012-07-13T02:33:23+09:00</updated>
  <id>http://guofei.github.com/master_report/</id>
  <author>
    <name><![CDATA[kaku]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[js ctypes]]></title>
    <link href="http://guofei.github.com/master_report/blog/2012/07/12/js-ctypes/"/>
    <updated>2012-07-12T20:50:00+09:00</updated>
    <id>http://guofei.github.com/master_report/blog/2012/07/12/js-ctypes</id>
    <content type="html"><![CDATA[<h3>OpenSSLの本</h3>

<p>BIO部分：入出力の抽象化、暗号化や符号化,ファイルやネットワークといった入出力の詳細をアプリケーションから隠蔽する</p>

<h3>Ctypes</h3>

<p>firefoxのdebugツールでエラーを見た
var r = ctypes.open('/Users/kaku/ctypesrsa/components/libjsrsa.dylib');
エラー: couldn't open library</p>

<p>自分が書いたものが問題になるのかを確認するため、簡単なライブラリを書いた。</p>

<p>mytest.h
```</p>

<h1>ifndef <em>MYTEST_H</em></h1>

<h1>define <em>MYTEST_H</em></h1>

<p>int my_add(int a, int b);</p>

<h1>endif /<em> <em>MYTEST_H</em> </em>/</h1>

<p>```</p>

<p>mytest.c
```</p>

<h1>include "mytest.h"</h1>

<p>int my_add(int a, int b)
{</p>

<pre><code>    return a+b;
</code></pre>

<p>}
<code>
</code>
cc -dynamiclib mytest.c -o libmytest.dylib
```</p>

<p>macのgccは　llvm-gcc　なので、gccを入れて、もう一回コンパイルしたが、同じエラーになる。Xcodeでコンパイルしても、同じ
<code>
gcc-4.2 -dynamiclib mytest.c -o libmytest.dylib
</code></p>

<p>このURLで<a href="http://stackoverflow.com/questions/9348604/build-a-dll-to-be-used-by-mozilla-js-ctype">http://stackoverflow.com/questions/9348604/build-a-dll-to-be-used-by-mozilla-js-ctype</a>s同じような問題があった。windowsでライブラリを開く時、システムのライブラリだとうまく使えるが、自分が書いたライブラリは使えない。</p>

<p>以下のコードを追加すると、うまく実行できたらしい。DLLMainはダイナミックリンクライブラリためのエントリーポイント。
<code>
BOOL WINAPI DllMain(HINSTANCE hinstDLL, DWORD fdwReason, LPVOID lpvReserved)
{
  return TRUE;
}
</code></p>

<p>Mac OS XでDLLMain見たいなものがないらしいので、やめた。Linuxで試して、うまく利用できた。</p>

<p>今はライブラリを書いている。javascriptとCの間の型の変換の部分は少し複雑</p>
]]></content>
  </entry>
  
</feed>
